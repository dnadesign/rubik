!function(a){"use strict";a.fn.Rubik=function(b){var c=a.extend({},a.fn.Rubik.defaults);return c=a.extend(c,b),this.each(function(){var b,d,e,f,g,h,i=a(this),j=1,k=a("."+c.domPagerClass,i),l=a("."+c.domPrevClass,i),m=a("."+c.domNextClass,i),n=k.find(".a"),o=0,p=!1,q=a.timer(function(){j==f.length?s.goTo(1):s.goTo(j+1)}).set({time:c.autoStartWait}),r=!1,s={config:c,assessContainers:function(){var k,l=9999,m=0;g=Math.round(b.width()/a(f[0]).outerWidth()),isNaN(g)||o!==g&&(o=g,f.each(function(){var b=a(this);b.parent("."+c.domPageClass).length>0&&(b.detach(),d.append(b))}),d.find("."+c.domPageClass).remove(),f.each(function(){var b=a(this);l+=1,l>g&&(k=a('<div class="'+c.domPageClass+'"/>'),d.append(k),l=1,m+=1),b.detach(),k.append(b)}),e=d.find("."+c.domPageClass).css({width:1/m*100+"%"}),d.css({width:100*m+"%"}),s.setupControls(),s.setupEvents(),s.setupCurrent(c.startAt),s.goTo(j,!0),Modernizr.csstransforms&&Modernizr.touch&&e.length>1&&b.each(function(){h=new Swipe(this,{callback:function(b,c,d){j=c+1,a(d).parent().parent().parent().data("Rubik").update()}})}),c.assessCallback(i,j))},disable:function(){l.css({visibility:"hidden"}),m.css({visibility:"hidden"})},enable:function(){l.css({visibility:"visible"}),m.css({visibility:"visible"})},getCurrent:function(){return j},goTo:function(f,g,k){var l=parseInt(a(e[0]).outerWidth(),10)/b.width()*100,m=parseInt(d.outerWidth(),10)/b.width()*100;return 1>f?!1:Math.round((f-1)*l)>Math.round(m-100)?!1:(k!==!0&&(Modernizr.csstransitions?d.css({x:-1*(j-1)*l/e.length+"%"}):d.css({left:-1*(j-1)*l+"%"})),j=f,DO.Fire("rubik:goto",[i]),d.stop(),g?Modernizr.csstransitions?d.transition({x:-1*(f-1)*l/e.length+"%"},0,"in-out",function(){DO.Fire("rubik:goto_done",[i])}):(d.css({left:-1*(j-1)*l+"%"}),DO.Fire("rubik:goto_done",[i])):Modernizr.csstransitions?d.transition({x:-1*(f-1)*l/e.length+"%"},c.transitionSpeedCSS,"in-out",function(){DO.Fire("rubik:goto_done",[i])}):d.animate({left:-1*(f-1)*l+"%"},c.transitionSpeed,c.transitionEasing,function(){DO.Fire("rubik:goto_done",[i])}),s.update(),h&&h.setPos(j-1),void 0)},gotoNext:function(){if(DO.Fire("rubik:next",[]),s.stopAutoScroll(),s.goTo(j+1),c.autoStart&&c.autoStartRestartAfterWait>0){var b=a.timer(s.startAutoScroll);b.once(c.autoStartRestartAfterWait)}return(j-1)/(e.length-1)},gotoPrev:function(){if(DO.Fire("rubik:prev",[]),s.stopAutoScroll(),s.goTo(j-1),c.autoStart&&c.autoStartRestartAfterWait>0){var b=a.timer(s.startAutoScroll);b.once(c.autoStartRestartAfterWait)}return(j-1)/(e.length-1)},gotoStart:function(){if(s.stopAutoScroll(),s.goTo(1),c.autoStart&&c.autoStartRestartAfterWait>0){var b=a.timer(s.startAutoScroll);b.once(c.autoStartRestartAfterWait)}return(j-1)/(e.length-1)},resize:function(){s.setupDimensions(),s.assessContainers(),DO.Fire("rubik:resize",[i])},setupControls:function(){if(e.length>1){if(c.hasControls&&(0===l.length&&(i.append('<span class="'+c.domPrevClass+'">Previous</span>'),l=a("."+c.domPrevClass,i)),0===m.length&&(i.append('<span class="'+c.domNextClass+'">Next</span>'),m=a("."+c.domNextClass,i))),c.hasPager){k.remove(),i.append('<ul class="'+c.domPagerClass+'"/>'),k=a("."+c.domPagerClass,i);var b;for(b=1;b<=e.length;b+=1)k.append('<li><span class="a" data-pos="'+b+'">Page '+b+"</span></li>");n=k.find(".a")}}else k.length>0&&k.hide(),l.hide(),m.hide()},setupCurrent:function(a){switch(a){case"start":j=1;break;case"middle":j=Math.ceil(e.length/2);break;case"end":j=e.length}},setupDimensions:function(){var c=0,e=0;f.css({height:"auto"}),d.css({position:"absolute"}),f.each(function(){e=a(this).outerHeight(),e>c&&(c=e)}),f.css({height:"100%"}),b.css({paddingTop:c,height:0}),d.css({height:c})},setupEvents:function(){if(l.unbind("touchend click").on("touchend click",function(a){switch(a.type){case"touchend":if(l.data("dragged"))return l.data("dragged",!1),!1;a.preventDefault(),l.data("handled",!0);break;case"click":if(a.preventDefault(),l.data("handled"))return l.data("handled",!1),!1}s.gotoPrev()}),m.unbind("touchend click").on("touchend click",function(a){switch(a.type){case"touchend":if(m.data("dragged"))return m.data("dragged",!1),!1;a.preventDefault(),m.data("handled",!0);break;case"click":if(a.preventDefault(),m.data("handled"))return m.data("handled",!1),!1}s.gotoNext()}),n.unbind("click").on("touchend click",function(b){switch(b.type){case"touchend":if(n.data("dragged"))return n.data("dragged",!1),!1;b.preventDefault(),n.data("handled",!0);break;case"click":if(b.preventDefault(),n.data("handled"))return n.data("handled",!1),!1}s.stopAutoScroll();var d,e=parseInt(a(this).data("pos"),10);s.goTo(e),c.autoStart&&c.autoStartRestartAfterWait>0&&(d=a.timer(s.startAutoScroll),d.once(c.autoStartRestartAfterWait))}),!r){var b,d=a(window),e=d.width(),f=d.height();d.on("resize",function(){var a=d.width(),c=d.height();(e!==a||f!==c)&&(clearTimeout(b),b=setTimeout(function(){s.resize()},200),e=a,f=c)}),r=!0}},setupHTML:function(){i.wrapInner('<div class="'+c.domInnerClass+'" />'),d=i.children("."+c.domInnerClass),i.wrapInner('<div class="'+c.domHolderClass+'" />'),b=i.children("."+c.domHolderClass),f=d.children("."+c.domItemClass),f.each(function(){var b=a(this);b.data("pos",b.index()+1)})},setupTimers:function(){1==c.autoStart&&e&&e.length>1&&q.play()},snap:function(){var a;return Modernizr.csstransitions?(a=d.css("transform")._translateX,a=parseInt(a.substr(0,a.length-1),10)/100*-1,a/=(e.length-1)/e.length):a=-1*parseInt(d.css("left"),10)/i.width()/(d.width()/b.width()-1),s.goTo(Math.round(a*(e.length-1))+1,!1,!0),(j-1)/(e.length-1)},startAutoScroll:function(){p&&q.play()},stopAutoScroll:function(){p=!0,q.stop()},update:function(){var a;k.length>0&&(a=j,a>e.length&&(a-=e.length),k.find(".active").removeClass("active"),k.find('.a[data-pos="'+a+'"]').addClass("active")),1>=j?l.hide():l.show(),j>=e.length?m.hide():m.show()}};return i.find("."+c.domInnerClass).length>0?!0:(s.setupHTML(),s.setupDimensions(),s.assessContainers(),s.setupTimers(),i.addClass("carousel_ready"),i.data("Rubik",s),DO.Fire("rubik:ready",[i]),void 0)})},a.fn.Rubik.defaults={autoStart:!1,autoStartRestartAfterWait:0,autoStartWait:6e3,assessCallback:function(){},domHolderClass:"carousel_holder",domInnerClass:"carousel_items",domItemClass:"carousel_item",domPrevClass:"carousel_previous",domNextClass:"carousel_next",domPageClass:"carousel_page",domPagerClass:"carousel_pager",hasControls:!0,hasPager:!0,startAt:1,transitionEasing:"swing",transitionSpeed:2e3,transitionSpeedCSS:800}}(jQuery);